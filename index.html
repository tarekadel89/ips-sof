<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>tarekadel89 - SMART on FHIR App</title>
  <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
</head>
<body>
  <h1>SMART on FHIR App</h1>
  <div id="app">Loading patient...</div>

  <script>
    FHIR.oauth2.ready().then(function(client) {
      // Check if we have a patient context
      if (!client.patient || !client.patient.id) {
        document.getElementById("app").innerText =
          "Error: No patient context. Launch this app from within the EHR.";
        return;
      }

      // Request the Patient resource
      client.request("Patient/" + client.patient.id)
        .then(function(patient) {
          let displayName = "Unknown Patient";

          if (patient.name && patient.name[0]) {
            let given = patient.name[0].given ? patient.name[0].given.join(" ") : "";
            let family = patient.name[0].family || "";
            displayName = (given + " " + family).trim();
          }

          document.getElementById("app").innerText = "Hello, " + displayName;
        })
        .catch(function(error) {
          console.error("Failed to load patient:", error);
          document.getElementById("app").innerText =
            "Failed to load patient: " + (error.message || JSON.stringify(error));
        });
    });
  </script>
</body>
</html>
